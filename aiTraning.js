// creating training data

let trainingData = [];

const canvas = document.getElementById("can");
const ctx = canvas.getContext("2d");

const trainingModal = document.querySelector(".training");
const [blackBtn, whiteBtn] = trainingModal.querySelectorAll(".black, .white");

let trainingInput = [];

blackBtn.addEventListener("click", (e) => {
  e.preventDefault();
  const output = [0];
  setTrainingData(trainingInput, output);
  modalDefault();
});
whiteBtn.addEventListener("click", (e) => {
  e.preventDefault();
  const output = [1];
  setTrainingData(trainingInput, output);

  modalDefault();
});

function modalDefault() {
  trainingModal.style.display = "none";
}

const image = new Image();
image.src = "images/ (1).jpg";

image.addEventListener("load", () => {
  canvas.height = image.height;
  canvas.width = image.width;

  ctx.imageSmoothingEnabled = true;
  ctx.imageSmoothingQuality = "high";
  ctx.drawImage(image, 0, 0);
});

canvas.addEventListener("click", createTrainingData);

function setTrainingData(input, output) {
  trainingData.push({
    input,
    output,
  });
}

// ---------------------------------

// const trainingData = [
//   {
//     input: [20, 40, 200, 20, 10, 9],
//     output: [0],
//   },
//   {
//     input: [200, 40, 200, 200, 100, 9],
//     output: [1],
//   },
// ];

// const b = new brain.NeuralNetwork();

// b.train(trainingData);

// console.time();
// console.log(b.run([200, 40, 200, 20, 10, 9]));
// console.timeEnd();

// const data =
//   '[{"input":[79,67,69,73,79,71,72,73,72,68,67,66,72,68,62,56],"output":[0]},{"input":[61,64,57,57,59,59,61,61,54,52,56,56,61,58,61,61],"output":[0]},{"input":[65,58,61,63,68,68,68,65,63,65,70,68,61,68,70,65],"output":[0]},{"input":[61,68,66,68,66,66,64,68,64,66,66,71,64,66,66,71],"output":[0]},{"input":[70,70,68,65,70,68,65,65,65,65,65,68,63,61,63,65],"output":[0]},{"input":[63,72,65,67,65,82,70,70,65,82,77,70,67,79,76,65],"output":[0]},{"input":[91,93,86,86,93,96,89,84,98,100,93,89,93,95,93,91],"output":[0]},{"input":[114,103,93,103,107,103,91,98,90,91,84,82,148,141,124,124],"output":[0]},{"input":[83,71,106,132,85,90,113,123,90,97,104,109,71,76,76,76],"output":[0]},{"input":[383,383,381,383,386,383,383,381,381,381,386,383,379,379,386,383],"output":[1]},{"input":[283,285,285,271,276,271,271,271,276,283,280,264,285,290,285,266],"output":[1]},{"input":[259,262,271,273,269,259,271,271,285,283,271,266,266,292,278,259],"output":[1]},{"input":[258,271,264,264,253,249,256,265,251,250,264,259,255,257,257,259],"output":[1]},{"input":[270,274,267,262,270,262,251,253,275,255,255,262,269,267,276,278],"output":[1]},{"input":[278,285,278,278,285,285,264,271,290,290,287,273,297,294,283,273],"output":[1]},{"input":[329,327,329,327,315,325,329,322,322,322,332,329,326,333,334,325],"output":[1]},{"input":[346,348,334,318,339,325,329,308,336,332,329,308,334,329,336,336],"output":[1]},{"input":[341,341,343,343,346,343,343,346,343,348,343,346,334,350,341,343],"output":[1]},{"input":[358,361,354,351,358,360,353,353,353,353,353,350,350,348,353,353],"output":[1]},{"input":[340,340,357,362,340,338,336,346,343,343,341,343,339,343,346,355],"output":[1]},{"input":[348,341,343,346,355,348,345,345,350,348,345,348,343,348,345,348],"output":[1]},{"input":[341,336,339,339,343,336,341,336,346,334,334,341,341,341,334,334],"output":[1]},{"input":[363,360,357,357,353,360,366,361,350,361,370,366,353,368,374,370],"output":[1]},{"input":[390,390,390,390,390,385,385,385,397,397,388,383,390,395,390,383],"output":[1]},{"input":[416,414,416,419,419,409,407,414,407,407,405,407,414,414,407,407],"output":[1]},{"input":[418,413,415,418,420,415,415,411,418,418,415,411,416,413,415,413],"output":[1]},{"input":[410,409,406,408,413,414,410,410,401,411,413,410,413,416,417,415],"output":[1]},{"input":[404,397,401,406,401,401,404,406,401,406,404,401,404,404,404,404],"output":[1]},{"input":[399,404,404,404,399,404,404,404,401,399,399,399,394,394,394,399],"output":[1]},{"input":[394,390,392,392,392,387,394,397,392,392,394,397,390,392,392,392],"output":[1]},{"input":[388,386,379,381,383,378,381,383,388,383,388,376,385,383,387,373],"output":[1]},{"input":[352,345,350,357,363,370,370,365,359,373,370,363,359,359,363,370],"output":[1]},{"input":[355,351,353,358,360,360,358,358,361,355,351,351,355,351,355,355],"output":[1]},{"input":[379,384,383,381,381,384,383,379,377,382,383,379,379,382,386,383],"output":[1]},{"input":[393,390,390,393,390,390,393,395,390,388,390,393,393,390,390,390],"output":[1]},{"input":[383,385,378,376,378,373,380,378,380,383,380,380,380,383,383,380],"output":[1]},{"input":[381,381,386,381,381,374,381,381,381,374,381,378,376,376,379,378],"output":[1]},{"input":[85,80,89,87,89,89,89,92,92,104,95,93,93,100,89,92],"output":[0]},{"input":[93,86,88,88,87,92,122,124,81,90,114,118,79,87,112,140],"output":[0]},{"input":[82,81,76,102,86,76,76,83,84,75,80,58,93,72,98,114],"output":[0]},{"input":[69,83,83,83,83,80,95,101,90,71,81,79,79,68,59,59],"output":[0]},{"input":[68,75,72,77,70,77,70,70,76,76,78,72,78,73,76,80],"output":[0]},{"input":[54,51,50,49,54,54,53,50,63,75,79,74,77,82,82,72],"output":[0]},{"input":[86,77,74,79,88,81,91,86,73,73,66,69,71,71,69,78],"output":[0]},{"input":[85,85,88,86,90,86,86,88,93,93,91,86,91,93,95,91],"output":[0]}]';

const data =
  '[{"input":[418,413,415,418,420,415,415,411,418,418,415,411,416,413,415,413],"output":[1]},{"input":[410,409,406,408,413,414,410,410,401,411,413,410,413,416,417,415],"output":[1]},{"input":[404,397,401,406,401,401,404,406,401,406,404,401,404,404,404,404],"output":[1]},{"input":[399,404,404,404,399,404,404,404,401,399,399,399,394,394,394,399],"output":[1]},{"input":[394,390,392,392,392,387,394,397,392,392,394,397,390,392,392,392],"output":[1]},{"input":[388,386,379,381,383,378,381,383,388,383,388,376,385,383,387,373],"output":[1]},{"input":[352,345,350,357,363,370,370,365,359,373,370,363,359,359,363,370],"output":[1]},{"input":[355,351,353,358,360,360,358,358,361,355,351,351,355,351,355,355],"output":[1]},{"input":[379,384,383,381,381,384,383,379,377,382,383,379,379,382,386,383],"output":[1]},{"input":[393,390,390,393,390,390,393,395,390,388,390,393,393,390,390,390],"output":[1]},{"input":[383,385,378,376,378,373,380,378,380,383,380,380,380,383,383,380],"output":[1]},{"input":[381,381,386,381,381,374,381,381,381,374,381,378,376,376,379,378],"output":[1]},{"input":[85,80,89,87,89,89,89,92,92,104,95,93,93,100,89,92],"output":[0]},{"input":[93,86,88,88,87,92,122,124,81,90,114,118,79,87,112,140],"output":[0]},{"input":[82,81,76,102,86,76,76,83,84,75,80,58,93,72,98,114],"output":[0]},{"input":[69,83,83,83,83,80,95,101,90,71,81,79,79,68,59,59],"output":[0]},{"input":[68,75,72,77,70,77,70,70,76,76,78,72,78,73,76,80],"output":[0]},{"input":[54,51,50,49,54,54,53,50,63,75,79,74,77,82,82,72],"output":[0]},{"input":[86,77,74,79,88,81,91,86,73,73,66,69,71,71,69,78],"output":[0]}]';
trainingData = JSON.parse(data);

const config = {
  hiddenLayers: [1],
};

// create a simple recurrent neural network
const b = new brain.recurrent.RNN(config);

b.train(trainingData, { log: true, iterations: 2000 });

console.time();

console.timeEnd();

function createTrainingData(event) {
  const x = event.clientX,
    y = event.clientY;

  const imageData = ctx.getImageData(x, y, 4, 4);
  const data = imageData.data;

  trainingInput = [];
  for (let i = 0; i < data.length; i += 4) {
    const r = data[i];
    const g = data[i + 1];
    const b = data[i + 2];

    const avg = r + g + b / 3;

    trainingInput.push(Math.round(avg));
  }

  // output
  trainingModal.style.display = "initial";
  const run = b.run(trainingInput);
  for (let i = 0; i < data.length; i += 4) {
    if (run < 0.5) {
      data[i] = 255;
      data[i + 1] = 255;
      data[i + 2] = 255;
    } else {
      data[i] = 0;
      data[i + 1] = 0;
      data[i + 2] = 0;
    }
  }
  console.log(run);
  imageData.data = data;

  ctx.putImageData(imageData, x, y);
}
