// creating training data

let trainingData = [];

const canvas = document.getElementById("can");
const ctx = canvas.getContext("2d");

const trainingModal = document.querySelector(".training");
const [blackBtn, whiteBtn] = trainingModal.querySelectorAll(".black, .white");

let trainingInput = [];

blackBtn.addEventListener("click", (e) => {
  e.preventDefault();
  const output = [0];
  setTrainingData(trainingInput, output);
  modalDefault();
});
whiteBtn.addEventListener("click", (e) => {
  e.preventDefault();
  const output = [1];
  setTrainingData(trainingInput, output);

  modalDefault();
});

function modalDefault() {
  trainingModal.style.display = "none";
}

const image = new Image();
image.src = "images/ (1).jpg";

image.addEventListener("load", () => {
  canvas.height = image.height;
  canvas.width = image.width;

  ctx.imageSmoothingEnabled = true;
  ctx.imageSmoothingQuality = "high";
  ctx.drawImage(image, 0, 0);
});

canvas.addEventListener("click", createTrainingData);

function setTrainingData(input, output) {
  trainingData.push({
    input,
    output,
  });
}

// ---------------------------------

// const trainingData = [
//   {
//     input: [20, 40, 200, 20, 10, 9],
//     output: [0],
//   },
//   {
//     input: [200, 40, 200, 200, 100, 9],
//     output: [1],
//   },
// ];

// const b = new brain.NeuralNetwork();

// b.train(trainingData);

// console.time();
// console.log(b.run([200, 40, 200, 20, 10, 9]));
// console.timeEnd();

// const data =
//   '[{"input":[79,67,69,73,79,71,72,73,72,68,67,66,72,68,62,56],"output":[0]},{"input":[61,64,57,57,59,59,61,61,54,52,56,56,61,58,61,61],"output":[0]},{"input":[65,58,61,63,68,68,68,65,63,65,70,68,61,68,70,65],"output":[0]},{"input":[61,68,66,68,66,66,64,68,64,66,66,71,64,66,66,71],"output":[0]},{"input":[70,70,68,65,70,68,65,65,65,65,65,68,63,61,63,65],"output":[0]},{"input":[63,72,65,67,65,82,70,70,65,82,77,70,67,79,76,65],"output":[0]},{"input":[91,93,86,86,93,96,89,84,98,100,93,89,93,95,93,91],"output":[0]},{"input":[114,103,93,103,107,103,91,98,90,91,84,82,148,141,124,124],"output":[0]},{"input":[83,71,106,132,85,90,113,123,90,97,104,109,71,76,76,76],"output":[0]},{"input":[383,383,381,383,386,383,383,381,381,381,386,383,379,379,386,383],"output":[1]},{"input":[283,285,285,271,276,271,271,271,276,283,280,264,285,290,285,266],"output":[1]},{"input":[259,262,271,273,269,259,271,271,285,283,271,266,266,292,278,259],"output":[1]},{"input":[258,271,264,264,253,249,256,265,251,250,264,259,255,257,257,259],"output":[1]},{"input":[270,274,267,262,270,262,251,253,275,255,255,262,269,267,276,278],"output":[1]},{"input":[278,285,278,278,285,285,264,271,290,290,287,273,297,294,283,273],"output":[1]},{"input":[329,327,329,327,315,325,329,322,322,322,332,329,326,333,334,325],"output":[1]},{"input":[346,348,334,318,339,325,329,308,336,332,329,308,334,329,336,336],"output":[1]},{"input":[341,341,343,343,346,343,343,346,343,348,343,346,334,350,341,343],"output":[1]},{"input":[358,361,354,351,358,360,353,353,353,353,353,350,350,348,353,353],"output":[1]},{"input":[340,340,357,362,340,338,336,346,343,343,341,343,339,343,346,355],"output":[1]},{"input":[348,341,343,346,355,348,345,345,350,348,345,348,343,348,345,348],"output":[1]},{"input":[341,336,339,339,343,336,341,336,346,334,334,341,341,341,334,334],"output":[1]},{"input":[363,360,357,357,353,360,366,361,350,361,370,366,353,368,374,370],"output":[1]},{"input":[390,390,390,390,390,385,385,385,397,397,388,383,390,395,390,383],"output":[1]},{"input":[416,414,416,419,419,409,407,414,407,407,405,407,414,414,407,407],"output":[1]},{"input":[418,413,415,418,420,415,415,411,418,418,415,411,416,413,415,413],"output":[1]},{"input":[410,409,406,408,413,414,410,410,401,411,413,410,413,416,417,415],"output":[1]},{"input":[404,397,401,406,401,401,404,406,401,406,404,401,404,404,404,404],"output":[1]},{"input":[399,404,404,404,399,404,404,404,401,399,399,399,394,394,394,399],"output":[1]},{"input":[394,390,392,392,392,387,394,397,392,392,394,397,390,392,392,392],"output":[1]},{"input":[388,386,379,381,383,378,381,383,388,383,388,376,385,383,387,373],"output":[1]},{"input":[352,345,350,357,363,370,370,365,359,373,370,363,359,359,363,370],"output":[1]},{"input":[355,351,353,358,360,360,358,358,361,355,351,351,355,351,355,355],"output":[1]},{"input":[379,384,383,381,381,384,383,379,377,382,383,379,379,382,386,383],"output":[1]},{"input":[393,390,390,393,390,390,393,395,390,388,390,393,393,390,390,390],"output":[1]},{"input":[383,385,378,376,378,373,380,378,380,383,380,380,380,383,383,380],"output":[1]},{"input":[381,381,386,381,381,374,381,381,381,374,381,378,376,376,379,378],"output":[1]},{"input":[85,80,89,87,89,89,89,92,92,104,95,93,93,100,89,92],"output":[0]},{"input":[93,86,88,88,87,92,122,124,81,90,114,118,79,87,112,140],"output":[0]},{"input":[82,81,76,102,86,76,76,83,84,75,80,58,93,72,98,114],"output":[0]},{"input":[69,83,83,83,83,80,95,101,90,71,81,79,79,68,59,59],"output":[0]},{"input":[68,75,72,77,70,77,70,70,76,76,78,72,78,73,76,80],"output":[0]},{"input":[54,51,50,49,54,54,53,50,63,75,79,74,77,82,82,72],"output":[0]},{"input":[86,77,74,79,88,81,91,86,73,73,66,69,71,71,69,78],"output":[0]},{"input":[85,85,88,86,90,86,86,88,93,93,91,86,91,93,95,91],"output":[0]}]';

const data =
  '[{"input":[155,153,150,154,155,155,151,152,155,157,153,154,151,154,153,153],"output":[1]},{"input":[155,155,155,156,157,158,158,158,157,157,157,157,158,159,159,157],"output":[1]},{"input":[142,141,136,145,144,141,131,141,144,144,136,137,144,142,143,139],"output":[1]},{"input":[146,148,147,150,146,147,146,148,148,148,147,148,148,145,148,147],"output":[1]},{"input":[157,158,158,155,158,157,157,155,151,152,158,160,154,156,160,159],"output":[1]},{"input":[32,26,20,18,44,39,22,30,54,57,52,42,89,92,107,107],"output":[0]},{"input":[34,34,31,31,31,31,30,29,31,31,30,27,29,28,29,28],"output":[0]},{"input":[26,25,25,25,26,27,26,25,24,26,26,24,26,27,27,26],"output":[0]},{"input":[33,33,33,31,59,59,61,57,69,67,66,66,120,117,108,98],"output":[0]},{"input":[41,40,41,40,42,41,36,42,31,36,40,46,39,41,41,44],"output":[0]},{"input":[38,37,36,38,36,37,38,39,37,40,41,40,39,40,39,42],"output":[0]},{"input":[35,35,37,38,39,36,36,37,38,36,36,36,39,37,36,36],"output":[0]},{"input":[35,34,31,40,45,43,34,39,45,50,43,38,41,41,40,38],"output":[0]},{"input":[165,167,166,168,166,166,166,166,167,166,164,166,166,165,163,164],"output":[1]},{"input":[168,168,170,169,167,168,170,169,168,167,166,167,168,167,166,166],"output":[1]},{"input":[138,143,140,133,141,141,135,139,141,138,134,140,142,139,136,136],"output":[1]},{"input":[146,147,146,147,147,146,145,144,148,147,149,150,149,146,145,147],"output":[1]},{"input":[142,143,141,141,140,143,144,141,142,142,143,136,149,149,148,144],"output":[1]},{"input":[155,157,158,155,151,152,154,155,153,152,153,151,156,155,152,154],"output":[1]},{"input":[155,152,149,149,155,152,150,152,150,147,148,149,149,152,149,148],"output":[1]},{"input":[150,146,150,149,142,146,151,148,137,147,152,152,143,151,151,153],"output":[1]},{"input":[150,149,149,147,148,147,148,149,146,149,149,149,147,149,148,147],"output":[1]},{"input":[135,140,141,141,140,141,143,143,145,142,142,143,143,146,144,140],"output":[1]},{"input":[135,141,144,140,137,142,144,141,140,140,136,139,141,142,134,134],"output":[1]},{"input":[130,126,135,138,129,130,138,138,140,136,138,136,138,137,141,142],"output":[1]},{"input":[150,147,143,144,151,149,144,145,149,151,146,145,147,147,144,143],"output":[1]},{"input":[138,140,139,137,138,138,139,140,136,137,142,138,136,136,144,139],"output":[1]},{"input":[143,143,142,143,137,142,144,144,130,135,140,138,132,133,142,139],"output":[1]},{"input":[140,141,138,140,140,138,139,145,141,140,141,144,140,139,141,139],"output":[1]},{"input":[137,136,136,138,140,138,138,138,140,138,139,139,141,138,137,138],"output":[1]},{"input":[134,137,140,144,133,138,140,145,137,138,134,141,138,137,135,143],"output":[1]},{"input":[130,131,133,133,130,130,130,124,128,129,132,128,129,128,132,130],"output":[1]},{"input":[137,138,135,137,134,138,136,137,136,140,137,138,139,141,137,135],"output":[1]},{"input":[135,135,135,139,138,137,138,139,140,140,138,139,139,140,138,140],"output":[1]},{"input":[139,141,140,141,137,137,136,137,139,138,137,137,145,141,140,139],"output":[1]},{"input":[121,120,121,122,122,120,118,119,121,121,119,120,120,121,120,122],"output":[1]},{"input":[34,35,34,33,32,30,31,30,34,33,35,33,35,34,34,35],"output":[0]},{"input":[35,36,37,37,34,35,36,33,35,35,35,32,36,36,34,36],"output":[0]},{"input":[32,38,38,40,35,35,38,38,34,37,36,39,33,33,33,36],"output":[0]},{"input":[44,46,43,40,43,45,42,38,42,41,41,37,41,40,37,36],"output":[0]},{"input":[46,45,42,32,44,40,43,36,45,43,40,37,45,43,37,30],"output":[0]},{"input":[62,54,38,34,61,52,36,35,56,48,35,38,52,45,33,39],"output":[0]},{"input":[47,58,59,56,47,55,55,50,48,49,47,46,45,45,50,45],"output":[0]},{"input":[47,44,41,37,40,44,41,43,33,42,44,43,26,37,44,43],"output":[0]},{"input":[40,42,41,43,52,44,52,68,53,56,53,72,86,97,89,102],"output":[0]},{"input":[42,41,48,51,40,43,49,51,43,41,49,50,45,43,42,43],"output":[0]},{"input":[53,43,44,49,45,38,46,54,45,38,41,46,45,41,41,44],"output":[0]},{"input":[162,165,166,166,163,163,164,166,166,165,166,166,169,166,165,165],"output":[1]},{"input":[161,162,161,162,162,162,160,161,163,163,162,163,162,161,161,163],"output":[1]},{"input":[154,152,152,155,151,153,156,156,154,153,152,154,155,153,151,151],"output":[1]},{"input":[31,33,37,38,31,32,33,30,28,25,27,28,29,33,38,42],"output":[0]},{"input":[31,32,32,30,33,33,34,33,33,34,35,33,33,33,34,33],"output":[0]},{"input":[34,48,46,34,36,36,36,30,39,35,37,36,37,38,40,39],"output":[0]},{"input":[30,30,33,32,30,32,32,30,31,33,31,29,33,33,33,34],"output":[0]}]';

trainingData = JSON.parse(data);

const config = {
  hiddenLayers: [20],
};

console.time();
// // create a simple recurrent neural network
const b = new brain.NeuralNetwork(config);

b.train(trainingData, { log: true, iterations: 2000 });

console.timeEnd();

function createTrainingData(event) {
  const x = event.clientX,
    y = event.clientY;

  const imageData = ctx.getImageData(x, y, 4, 4);
  const data = imageData.data;

  trainingInput = [];
  for (let i = 0; i < data.length; i += 4) {
    const R = data[i];
    const G = data[i + 1];
    const B = data[i + 2];

    const avg = (R + G + B) / 3;

    trainingInput.push(Math.round(avg));
  }

  // output
  trainingModal.style.display = "initial";
  const run = runAi();
  for (let i = 0; i < data.length; i += 4) {
    if (run < 0.5) {
      data[i] = 255;
      data[i + 1] = 255;
      data[i + 2] = 255;
    } else {
      data[i] = 0;
      data[i + 1] = 0;
      data[i + 2] = 0;
    }
  }
  console.log(run);
  imageData.data = data;

  ctx.putImageData(imageData, x, y);
}

function runAi() {
  console.log(trainingInput);
  return b.run(trainingInput)[0];
}
